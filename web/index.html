<!DOCTYPE html>
<html>
  <head>
    <!-- Can you tell it's been years since I touched the frontend? -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <!-- Style and scripts can move to own file-->
    <style>
      td {
        border: 1px solid black;
        height: 50px;
        width: 50px;
      }
    </style>
    <script>
      $(document).ready(function () {
        //FIXME: This leaves all cells clickable
        $(".empty").click(function () {
          console.log(this.id);
          $(this).find("p").text("X");
          readAndPost();
        });
      });

      function readAndPost() {
        //loop over divs and post board position to the backend
        pos = '{"State":"';
        $("td > p").each(function () {
          line = "-";
          if ($(this).text() !== undefined && $(this).text() !== "") {
            line = $(this).text();
          }

          pos += line;
        });
        pos += '"}';

        console.log(pos);

        $.post("/api/", pos, function (data) {
          console.log(data);
          json = JSON.parse(data);

          $("td > p").each(function (index) {
            //console.log(json.State[index])
            cellState = json.State[index];
            if (cellState !== "-") {
              $(this).text(cellState);
            }
          });
          console.log(json.Result);
        });
      }
    </script>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  </head>
  <body>
    <table>
      <tr>
        <td id="1" class="empty"><p></p></td>
        <td id="2" class="empty"><p></p></td>
        <td id="3" class="empty"><p></p></td>
      </tr>
      <tr>
        <td id="4" class="empty"><p></p></td>
        <td id="5" class="empty"><p></p></td>
        <td id="6" class="empty"><p></p></td>
      </tr>
      <tr>
        <td id="7" class="empty"><p></p></td>
        <td id="8" class="empty"><p></p></td>
        <td id="9" class="empty"><p></p></td>
      </tr>
    </table>
  </body>
</html>
